<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e40af">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-gradient: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            --card-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
            --text-color: #333;
            --sidebar-bg: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            --modal-bg: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            --category-edit-bg: rgba(255, 255, 255, 0.15);
            --primary-color: #2563eb;
            --primary-dark: #1e40af;
            --header-bg: #1e40af;
        }
        
        body.dark-mode {
            --bg-gradient: linear-gradient(135deg, #0f1419 0%, #17212b 50%, #1f2d3a 100%);
            --card-bg: linear-gradient(135deg, rgba(40, 50, 60, 0.95) 0%, rgba(30, 40, 50, 0.9) 100%);
            --text-color: #ffffff;
            --category-edit-bg: rgba(255, 255, 255, 0.08);
        }
        
        body.dark-mode.theme-blue { 
            --sidebar-bg: linear-gradient(135deg, #1e3a5f 0%, #1e3c72 100%); 
            --modal-bg: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); 
            --header-bg: #1e3c72;
        }
        body.dark-mode.theme-purple { 
            --sidebar-bg: linear-gradient(135deg, #4c1d95 0%, #5b21b6 100%); 
            --modal-bg: linear-gradient(135deg, #5b21b6 0%, #6d28d9 100%); 
            --header-bg: #5b21b6;
        }
        body.dark-mode.theme-green { 
            --sidebar-bg: linear-gradient(135deg, #064e3b 0%, #065f46 100%); 
            --modal-bg: linear-gradient(135deg, #065f46 0%, #047857 100%); 
            --header-bg: #065f46;
        }
        body.dark-mode.theme-teal { 
            --sidebar-bg: linear-gradient(135deg, #115e59 0%, #0f766e 100%); 
            --modal-bg: linear-gradient(135deg, #0f766e 0%, #0d9488 100%); 
            --header-bg: #0f766e;
        }
        body.dark-mode.theme-indigo { 
            --sidebar-bg: linear-gradient(135deg, #312e81 0%, #3730a3 100%); 
            --modal-bg: linear-gradient(135deg, #3730a3 0%, #4338ca 100%); 
            --header-bg: #3730a3;
        }
        body.dark-mode.theme-cyan { 
            --sidebar-bg: linear-gradient(135deg, #155e75 0%, #0e7490 100%); 
            --modal-bg: linear-gradient(135deg, #0e7490 0%, #0891b2 100%); 
            --header-bg: #0e7490;
        }
        body.dark-mode.theme-lime { 
            --sidebar-bg: linear-gradient(135deg, #3f6212 0%, #4d7c0f 100%); 
            --modal-bg: linear-gradient(135deg, #4d7c0f 0%, #65a30d 100%); 
            --header-bg: #4d7c0f;
        }
        body.dark-mode.theme-orange { 
            --sidebar-bg: linear-gradient(135deg, #92400e 0%, #b45309 100%); 
            --modal-bg: linear-gradient(135deg, #b45309 0%, #d97706 100%); 
            --header-bg: #b45309;
        }
        body.dark-mode.theme-skyblue { 
            --sidebar-bg: linear-gradient(135deg, #0c4a6e 0%, #0369a1 100%); 
            --modal-bg: linear-gradient(135deg, #0284c7 0%, #0ea5e9 100%); 
            --header-bg: #0369a1;
        }
        
        body.light-mode.theme-blue { 
            --sidebar-bg: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); 
            --modal-bg: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); 
            --header-bg: #2563eb;
        }
        body.light-mode.theme-purple { 
            --sidebar-bg: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%); 
            --modal-bg: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); 
            --header-bg: #8b5cf6;
        }
        body.light-mode.theme-green { 
            --sidebar-bg: linear-gradient(135deg, #10b981 0%, #059669 100%); 
            --modal-bg: linear-gradient(135deg, #10b981 0%, #059669 100%); 
            --header-bg: #10b981;
        }
        body.light-mode.theme-teal { 
            --sidebar-bg: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); 
            --modal-bg: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); 
            --header-bg: #14b8a6;
        }
        body.light-mode.theme-indigo { 
            --sidebar-bg: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); 
            --modal-bg: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); 
            --header-bg: #6366f1;
        }
        body.light-mode.theme-cyan { 
            --sidebar-bg: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); 
            --modal-bg: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); 
            --header-bg: #06b6d4;
        }
        body.light-mode.theme-lime { 
            --sidebar-bg: linear-gradient(135deg, #84cc16 0%, #65a30d 100%); 
            --modal-bg: linear-gradient(135deg, #84cc16 0%, #65a30d 100%); 
            --header-bg: #84cc16;
        }
        body.light-mode.theme-orange { 
            --sidebar-bg: linear-gradient(135deg, #f97316 0%, #ea580c 100%); 
            --modal-bg: linear-gradient(135deg, #f97316 0%, #ea580c 100%); 
            --header-bg: #f97316;
        }
        body.light-mode.theme-skyblue { 
            --sidebar-bg: linear-gradient(135deg, #7dd3fc 0%, #38bdf8 100%); 
            --modal-bg: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); 
            --header-bg: #38bdf8;
        }
        
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            transition: background 0.3s ease;
        }
        
        .bubble {
            position: fixed;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 15s infinite ease-in-out;
            z-index: 0;
        }
        
        .bubble:nth-child(1) { width: 80px; height: 80px; left: 10%; top: 20%; animation-delay: 0s; opacity: 0.3; }
        .bubble:nth-child(2) { width: 120px; height: 120px; right: 15%; top: 10%; animation-delay: 2s; opacity: 0.3; }
        .bubble:nth-child(3) { width: 100px; height: 100px; left: 20%; bottom: 15%; animation-delay: 4s; opacity: 0.3; }
        .bubble:nth-child(4) { width: 90px; height: 90px; right: 20%; bottom: 20%; animation-delay: 6s; opacity: 0.3; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-30px) rotate(180deg); }
        }
        
        header {
            background: var(--header-bg);
            color: white;
            padding: 50px 20px 20px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            transition: background 0.3s ease;
        }
        
        .header-left, .header-right { display: flex; align-items: center; gap: 15px; }
        .header-left i, .header-right i {
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 20px;
        }
        .header-left i:hover, .header-right i:hover { transform: scale(1.15); }
        header h1 { font-size: 22px; margin: 0; font-weight: 700; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 80px;
            position: relative;
            z-index: 1;
        }
        
        .income-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            padding: 30px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0, 136, 204, 0.4);
            animation: slideInDown 0.5s ease-out;
        }
        
        @keyframes slideInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); }}
        
        .income-input-wrapper {
            position: relative;
            flex: 1;
            display: flex;
            align-items: center;
        }
        
        .income-input-wrapper i {
            position: absolute;
            left: 15px;
            font-size: 22px;
            color: rgba(255, 255, 255, 0.7);
            pointer-events: none;
            z-index: 1;
        }
        
        .income-card input {
            border: none;
            border-bottom: 3px solid rgba(255, 255, 255, 0.5);
            font-size: 26px;
            width: 100%;
            outline: none;
            text-align: center;
            font-weight: bold;
            background: transparent;
            color: white;
            transition: border-color 0.3s;
            padding-left: 45px;
        }
        .income-card input::placeholder { color: rgba(255, 255, 255, 0.7); }
        .income-card input:focus { border-bottom-color: white; }
        
        .calc-btn {
            background: white;
            color: var(--primary-color);
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 26px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }
        .calc-btn:hover { transform: scale(1.1) rotate(90deg); box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4); }
        .calc-btn:active { transform: scale(0.95) rotate(90deg); }
        
        .category-item {
            background: var(--card-bg);
            margin-bottom: 15px;
            padding: 20px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transition: all 0.3s;
            animation: fadeInUp 0.5s ease-out;
            animation-fill-mode: both;
        }
        
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); }}
        .category-item:hover { transform: translateY(-5px); box-shadow: 0 12px 35px rgba(0,0,0,0.2); }
        
        .cat-info { display: flex; align-items: center; gap: 15px; flex: 1; }
        .cat-icon {
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .cat-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }
        @keyframes shine { 0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); } 100% { transform: translateX(100%) translateY(100%) rotate(45deg); }}
        
        .cat-details h3 {
            margin: 0;
            font-size: 16px;
            text-transform: uppercase;
            color: var(--text-color);
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .cat-amount { text-align: right; min-width: 120px; }
        .amount-val {
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 20px;
            display: block;
        }
        .percent-tag { font-size: 12px; color: #999; display: block; margin-top: 4px; font-weight: 600; }
        
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100%;
            width: 320px;
            background: var(--sidebar-bg);
            box-shadow: 2px 0 20px rgba(0,0,0,0.3);
            transform: translateX(-100%);
            transition: transform 0.3s ease, background 0.3s ease;
            z-index: 1001;
            padding: 25px;
            overflow-y: auto;
            color: white;
        }
        .sidebar.show { transform: translateX(0); }
        
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        .sidebar-overlay.show { display: block; }
        
        .sidebar-title {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .sidebar-menu { display: flex; flex-direction: column; gap: 15px; }
        .menu-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }
        
        .menu-section-header {
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.05);
        }
        .menu-section-header:hover { background: rgba(255, 255, 255, 0.15); }
        .menu-section-header.active { background: rgba(255, 255, 255, 0.2); }
        
        .menu-section-header-left { display: flex; align-items: center; gap: 12px; }
        .menu-section-icon {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 16px;
        }
        .menu-section-title { font-weight: 700; font-size: 16px; }
        .menu-section-toggle { transition: transform 0.3s; font-size: 14px; }
        .menu-section-toggle.rotated { transform: rotate(180deg); }
        
        .menu-section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .menu-section-content.expanded { max-height: 2000px; }
        
        .menu-subsection { padding: 10px 15px; border-top: 1px solid rgba(255, 255, 255, 0.1); }
        .subsection-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .categories-list-container {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            transition: max-height 0.3s ease, opacity 0.3s ease;
        }
        
        .categories-list-container.collapsed {
            max-height: 0;
            overflow: hidden;
            margin-bottom: 0;
            opacity: 0;
        }
        
        .categories-list-container::-webkit-scrollbar, .archive-list::-webkit-scrollbar { width: 8px; }
        .categories-list-container::-webkit-scrollbar-track, .archive-list::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        .categories-list-container::-webkit-scrollbar-thumb, .archive-list::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.3); border-radius: 10px; }
        .categories-list-container::-webkit-scrollbar-thumb:hover, .archive-list::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.5); }
        
        .input-with-icon {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .input-with-icon i {
            position: absolute;
            left: 14px;
            font-size: 15px;
            color: rgba(255, 255, 255, 0.7);
            pointer-events: none;
            z-index: 1;
        }
        
        .input-with-icon input {
            padding-left: 42px !important;
        }
        
        .form-group { 
            margin-bottom: 15px; 
            position: relative;
        }
        
        .form-group input {
            width: 100%;
            padding: 14px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            font-size: 15px;
            background: rgba(255, 255, 255, 0.12);
            color: white;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            font-weight: 500;
        }
        
        .form-group input::placeholder { 
            color: rgba(255, 255, 255, 0.75); 
            font-weight: 500;
        }
        
        .form-group input:focus { 
            outline: none; 
            border-color: rgba(255, 255, 255, 0.8); 
            background: rgba(255, 255, 255, 0.18); 
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.15);
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            width: 100%;
            box-shadow: 0 4px 15px rgba(14, 165, 233, 0.4);
        }
        .btn-success:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(14, 165, 233, 0.6); }
        .btn-success:active { transform: translateY(-1px); }
        
        .language-options-sidebar, .theme-options-sidebar {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .language-option-sidebar, .theme-option-sidebar {
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 2px solid transparent;
            font-size: 14px;
        }
        .language-option-sidebar:hover, .theme-option-sidebar:hover { background: rgba(255, 255, 255, 0.2); transform: translateX(5px); }
        .language-option-sidebar.active, .theme-option-sidebar.active {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15));
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .theme-option-preview { display: flex; gap: 4px; align-items: center; }
        .theme-preview-circle {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .color-picker-section, .icon-picker-section { margin-bottom: 15px; }
        .color-picker-label, .icon-picker-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 8px;
        }
        .color-picker-label:hover, .icon-picker-label:hover { background: rgba(255, 255, 255, 0.15); border-color: rgba(255, 255, 255, 0.5); }
        
        .color-picker-text, .icon-picker-text {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 13px;
        }
        .color-picker-toggle, .icon-picker-toggle { font-size: 12px; transition: transform 0.3s; }
        .color-picker-toggle.rotated, .icon-picker-toggle.rotated { transform: rotate(180deg); }
        
        .color-picker-content, .icon-picker-content {
            display: none;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            margin-top: 5px;
            max-height: 250px;
            overflow-y: auto;
        }
        .color-picker-content.show, .icon-picker-content.show { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; }}
        
        .color-options-container, .icon-options-container { display: flex; flex-wrap: wrap; gap: 8px; }
        .color-option {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }
        .color-option:hover { transform: scale(1.15); }
        .color-option.selected { border: 3px solid white; box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
        
        .icon-option {
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        .icon-option:hover { background: rgba(255, 255, 255, 0.2); transform: scale(1.15); }
        .icon-option.selected { background: #0ea5e9; color: white; box-shadow: 0 0 15px rgba(14, 165, 233, 0.8); }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: var(--modal-bg);
            margin: 5% auto;
            padding: 25px;
            width: 90%;
            max-width: 420px;
            border-radius: 20px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            color: white;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }
        .modal-header h2 { margin: 0; font-size: 20px; font-weight: 700; }
        
        .close-modal {
            cursor: pointer;
            font-size: 28px;
            line-height: 1;
            transition: all 0.3s;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }
        .close-modal:hover { background: rgba(255, 255, 255, 0.2); transform: rotate(90deg); }
        
        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .edit-modal-content {
            background: var(--modal-bg);
            padding: 25px;
            width: 90%;
            max-width: 400px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            color: white;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        .category-item-edit {
            background: var(--category-edit-bg);
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }
        .category-item-edit:hover { background: rgba(255, 255, 255, 0.2); transform: translateX(5px); }
        .category-item-edit .cat-info { gap: 10px; }
        .category-item-edit .cat-icon { width: 40px; height: 40px; font-size: 16px; }
        .category-item-edit .cat-details h3 { font-size: 14px; color: white; }
        .category-item-edit .cat-actions { display: flex; gap: 8px; }
        
        .action-btn {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
        }
        .action-btn.delete {
            background: linear-gradient(135deg, #fb7185 0%, #e11d48 100%);
            color: white;
            box-shadow: 0 3px 12px rgba(251, 113, 133, 0.3);
        }
        .action-btn.delete:hover { transform: scale(1.1); box-shadow: 0 5px 18px rgba(251, 113, 133, 0.5); }
        
        .confirm-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2999;
            backdrop-filter: blur(10px);
        }
        
        .confirm-box {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--modal-bg);
            padding: 25px;
            border-radius: 18px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            z-index: 3000;
            width: 300px;
            text-align: center;
            color: white;
        }
        .confirm-box p { margin: 0; font-size: 16px; margin-bottom: 20px; font-weight: 600; }
        .confirm-btns { display: flex; gap: 10px; margin-top: 20px; justify-content: center; }
        .c-btn {
            padding: 10px 22px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.3s;
            flex: 1;
        }
        .btn-yes {
            background: linear-gradient(135deg, #fb7185 0%, #e11d48 100%);
            color: white;
            box-shadow: 0 3px 12px rgba(251, 113, 133, 0.3);
        }
        .btn-yes:hover { transform: translateY(-2px); box-shadow: 0 5px 18px rgba(251, 113, 133, 0.5); }
        .btn-no {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .btn-no:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-2px); }
        
        .empty-state { text-align: center; padding: 40px 20px; color: rgba(255, 255, 255, 0.8); }
        .empty-state i { font-size: 48px; margin-bottom: 15px; opacity: 0.6; }
        .empty-state h3 { font-size: 16px; margin-bottom: 10px; font-weight: 700; }
        .empty-state p { font-size: 13px; opacity: 0.7; }
        
        #percentageAlert {
            background: rgba(253, 224, 71, 0.2);
            padding: 12px;
            border-radius: 10px;
            border-left: 4px solid #fde047;
            display: none;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            font-size: 13px;
        }
        #percentageAlert .fa-exclamation-triangle { color: #fde047; }
        
        .archive-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .archive-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }
        .archive-item:hover { background: rgba(255, 255, 255, 0.15); transform: translateX(5px); }
        
        .archive-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .archive-date { font-size: 13px; font-weight: 700; color: rgba(255, 255, 255, 0.9); }
        .archive-income { font-size: 14px; font-weight: 700; color: #7dd3fc; }
        .archive-text { 
            font-size: 12px; 
            color: rgba(255, 255, 255, 0.85); 
            margin-top: 10px;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
            font-family: 'Segoe UI', sans-serif;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.6;
        }
        .archive-actions { display: flex; gap: 8px; margin-top: 10px; }
        
        .archive-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .archive-btn.copy {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        .archive-btn.copy:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); }
        .archive-btn.delete { background: linear-gradient(135deg, #fb7185 0%, #e11d48 100%); color: white; }
        .archive-btn.delete:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(251, 113, 133, 0.4); }
        
        .restart-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .restart-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .restart-option:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .restart-option-icon {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }
        
        .restart-option-details {
            flex: 1;
        }
        
        .restart-option-title {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 4px;
            color: white;
        }
        
        .restart-option-desc {
            font-size: 12px;
            opacity: 0.8;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .category-item:nth-child(1) { animation-delay: 0.1s; }
        .category-item:nth-child(2) { animation-delay: 0.2s; }
        .category-item:nth-child(3) { animation-delay: 0.3s; }
        .category-item:nth-child(4) { animation-delay: 0.4s; }
        .category-item:nth-child(5) { animation-delay: 0.5s; }
        .category-item:nth-child(6) { animation-delay: 0.6s; }
        .category-item:nth-child(7) { animation-delay: 0.7s; }
        .category-item:nth-child(8) { animation-delay: 0.8s; }
        
        .input-error {
            border: 2px solid #fb7185 !important;
            background-color: rgba(251, 113, 133, 0.15) !important;
            animation: shake 0.5s ease;
            box-shadow: 0 0 0 3px rgba(251, 113, 133, 0.2) !important;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .error-message {
            color: #fb7185;
            font-size: 12px;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
            animation: fadeIn 0.3s ease;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 9999;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInRight 0.3s ease;
            max-width: 300px;
            color: white;
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @media (max-width: 480px) {
            .container { padding: 15px; padding-bottom: 80px; }
            .income-card { padding: 25px 20px; }
            .income-card input { font-size: 22px; }
            .calc-btn { width: 55px; height: 55px; font-size: 22px; }
            .category-item { padding: 18px; }
            .sidebar { width: 290px; }
            header h1 { font-size: 18px; }
            .form-group input { padding: 12px; padding-left: 42px; }
        }
    </style>
</head>
<body>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    
    <header>
        <div class="header-left">
            <i class="fas fa-bars" id="menuBtn"></i>
            <h1 id="appTitle">ðŸ’° Budget Calculator</h1>
        </div>
        <div class="header-right">
            <i class="fas fa-moon" id="darkModeToggle" title="Light Mode"></i>
        </div>
    </header>
    
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <div class="sidebar" id="sidebar">
        <div class="sidebar-title">
            <i class="fas fa-cogs"></i>
            <span id="sidebarTitleText">Settings</span>
        </div>
        
        <div class="sidebar-menu">
            <div class="menu-section">
                <div class="menu-section-header" onclick="toggleMenuSection('categories')">
                    <div class="menu-section-header-left">
                        <div class="menu-section-icon"><i class="fas fa-list-alt"></i></div>
                        <div class="menu-section-title" id="categoriesMenuTitle">Categories</div>
                    </div>
                    <i class="fas fa-chevron-down menu-section-toggle" id="categoriesToggle"></i>
                </div>
                <div class="menu-section-content" id="categoriesContent">
                    <div class="menu-subsection">
                        <div class="subsection-title">
                            <i class="fas fa-plus"></i>
                            <span id="addCategoryTitle">Add Category</span>
                        </div>
                        <div class="form-group category-name">
                            <div class="input-with-icon">
                                <i class="fas fa-pen"></i>
                                <input type="text" id="sidebarCategoryName" placeholder="Category name">
                            </div>
                        </div>
                        <div class="form-group category-percent">
                            <div class="input-with-icon">
                                <i class="fas fa-percent"></i>
                                <input type="number" id="sidebarCategoryPercentage" min="0" max="100" step="0.01" placeholder="Percentage">
                            </div>
                            <div id="percentageError" class="error-message" style="display: none;">
                                <i class="fas fa-exclamation-circle"></i>
                                <span id="percentageErrorText"></span>
                            </div>
                        </div>
                        <div class="icon-picker-section">
                            <div class="icon-picker-label" id="sidebarIconPickerLabel">
                                <div class="icon-picker-text">
                                    <i class="fas fa-icons"></i>
                                    <span id="iconLabel">Icon</span>
                                </div>
                                <i class="fas fa-chevron-down icon-picker-toggle" id="sidebarIconPickerToggle"></i>
                            </div>
                            <div class="icon-picker-content" id="sidebarIconPickerContent">
                                <div class="icon-options-container" id="sidebarIconOptions"></div>
                            </div>
                        </div>
                        <input type="hidden" id="sidebarSelectedIcon" value="fas fa-tag">
                        <div class="color-picker-section">
                            <div class="color-picker-label" id="sidebarColorPickerLabel">
                                <div class="color-picker-text">
                                    <i class="fas fa-palette"></i>
                                    <span id="colorLabel">Color</span>
                                </div>
                                <i class="fas fa-chevron-down color-picker-toggle" id="sidebarColorPickerToggle"></i>
                            </div>
                            <div class="color-picker-content" id="sidebarColorPickerContent">
                                <div class="color-options-container" id="sidebarColorOptions"></div>
                            </div>
                        </div>
                        <input type="hidden" id="sidebarSelectedColor" value="#4CAF50">
                        <button class="btn btn-success" id="sidebarAddCategoryBtn">
                            <i class="fas fa-plus"></i> <span id="addCategoryBtn">Add Category</span>
                        </button>
                    </div>
                    <div class="menu-subsection">
                        <div class="subsection-title" style="cursor: pointer;" onclick="toggleCategoriesListSection()" id="categoriesListHeader">
                            <i class="fas fa-list"></i>
                            <span id="categoriesListTitle">Categories List</span>
                            <i class="fas fa-chevron-down" style="margin-left: auto; font-size: 12px; transition: transform 0.3s;" id="categoriesListToggle"></i>
                        </div>
                        <div id="percentageAlert" class="form-group">
                            <div style="display: flex; align-items: flex-start; gap: 10px;">
                                <i class="fas fa-exclamation-triangle" style="margin-top: 2px;"></i>
                                <div>
                                    <div style="font-size: 13px; font-weight: 700;" id="alertTitle">Attention!</div>
                                    <div style="font-size: 12px;" id="alertMessage">Total percentage must equal 100%. Current: <span id="currentPercentage">0</span>%</div>
                                </div>
                            </div>
                        </div>
                        <div class="categories-list-container" id="categoriesList"></div>
                    </div>
                </div>
            </div>
            
            <div class="menu-section">
                <div class="menu-section-header" onclick="toggleMenuSection('language')">
                    <div class="menu-section-header-left">
                        <div class="menu-section-icon"><i class="fas fa-globe"></i></div>
                        <div class="menu-section-title" id="languageMenuTitle">Language</div>
                    </div>
                    <i class="fas fa-chevron-down menu-section-toggle" id="languageToggle"></i>
                </div>
                <div class="menu-section-content" id="languageContent">
                    <div class="menu-subsection">
                        <div class="language-options-sidebar" id="languageOptionsSidebar"></div>
                    </div>
                </div>
            </div>
            
            <div class="menu-section">
                <div class="menu-section-header" onclick="toggleMenuSection('theme')">
                    <div class="menu-section-header-left">
                        <div class="menu-section-icon"><i class="fas fa-palette"></i></div>
                        <div class="menu-section-title" id="themeMenuTitle">Theme</div>
                    </div>
                    <i class="fas fa-chevron-down menu-section-toggle" id="themeToggle2"></i>
                </div>
                <div class="menu-section-content" id="themeContent">
                    <div class="menu-subsection">
                        <div class="theme-options-sidebar" id="themeOptionsSidebar"></div>
                    </div>
                </div>
            </div>
            
            <div class="menu-section">
                <div class="menu-section-header" onclick="toggleMenuSection('archive')">
                    <div class="menu-section-header-left">
                        <div class="menu-section-icon"><i class="fas fa-archive"></i></div>
                        <div class="menu-section-title" id="archiveMenuTitle">Archive</div>
                    </div>
                    <i class="fas fa-chevron-down menu-section-toggle" id="archiveToggle"></i>
                </div>
                <div class="menu-section-content" id="archiveContent">
                    <div class="menu-subsection">
                        <div class="archive-list" id="archiveList">
                            <div class="empty-state">
                                <i class="fas fa-folder-open"></i>
                                <h3 id="noArchiveTitle">Archive is empty</h3>
                                <p id="noArchiveText">Calculated incomes will be saved here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="menu-section">
                <div class="menu-section-header" onclick="toggleMenuSection('restart')">
                    <div class="menu-section-header-left">
                        <div class="menu-section-icon"><i class="fas fa-redo"></i></div>
                        <div class="menu-section-title" id="restartMenuTitle">Restart Application</div>
                    </div>
                    <i class="fas fa-chevron-down menu-section-toggle" id="restartToggle"></i>
                </div>
                <div class="menu-section-content" id="restartContent">
                    <div class="menu-subsection">
                        <div class="restart-options">
                            <div class="restart-option" onclick="showRestartConfirm('all')">
                                <div class="restart-option-icon" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                                    <i class="fas fa-redo"></i>
                                </div>
                                <div class="restart-option-details">
                                    <div class="restart-option-title" id="restartAllTitle">Full Restart</div>
                                    <div class="restart-option-desc" id="restartAllDesc">Reset everything to default</div>
                                </div>
                            </div>
                            
                            <div class="restart-option" onclick="showRestartConfirm('categories')">
                                <div class="restart-option-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                                    <i class="fas fa-list"></i>
                                </div>
                                <div class="restart-option-details">
                                    <div class="restart-option-title" id="restartCategoriesTitle">Reset Categories Only</div>
                                    <div class="restart-option-desc" id="restartCategoriesDesc">Keep archive and settings</div>
                                </div>
                            </div>
                            
                            <div class="restart-option" onclick="showRestartConfirm('archive')">
                                <div class="restart-option-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                                    <i class="fas fa-archive"></i>
                                </div>
                                <div class="restart-option-details">
                                    <div class="restart-option-title" id="restartArchiveTitle">Clear Archive Only</div>
                                    <div class="restart-option-desc" id="restartArchiveDesc">Keep categories and settings</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="income-card">
            <div class="income-input-wrapper">
                <i class="fas fa-coins"></i>
                <input type="text" id="incomeAmount" inputmode="numeric" placeholder="Income" maxlength="15">
            </div>
            <button class="calc-btn" id="calculateBtn">
                <i class="fas fa-equals"></i>
            </button>
        </div>
        <div id="categoryResults"></div>
    </div>
    
    <div class="confirm-overlay" id="confirmOverlay"></div>
    <div class="confirm-box" id="confirmBox">
        <p id="confirmText">Delete?</p>
        <div class="confirm-btns">
            <button class="c-btn btn-no" onclick="closeConfirm()" id="confirmNoBtn">No</button>
            <button class="c-btn btn-yes" id="confirmYesBtn">Yes</button>
        </div>
    </div>
    
    <div class="edit-modal" id="editModal">
        <div class="edit-modal-content">
            <div class="modal-header">
                <h2 id="editModalTitle">Edit Category</h2>
                <span class="close-modal" id="closeModal">&times;</span>
            </div>
            <div class="form-group edit-name">
                <div class="input-with-icon">
                    <i class="fas fa-pen"></i>
                    <input type="text" id="editCategoryName" placeholder="Category name">
                </div>
            </div>
            <div class="form-group edit-percent">
                <div class="input-with-icon">
                    <i class="fas fa-percent"></i>
                    <input type="number" id="editCategoryPercentage" min="0" max="100" step="0.01" placeholder="Percentage">
                </div>
                <div id="editPercentageError" class="error-message" style="display: none;">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="editPercentageErrorText"></span>
                </div>
            </div>
            <div class="icon-picker-section">
                <div class="icon-picker-label" id="editIconPickerLabel">
                    <div class="icon-picker-text">
                        <i class="fas fa-icons"></i>
                        <span id="editIconLabel">Icon</span>
                    </div>
                    <i class="fas fa-chevron-down icon-picker-toggle" id="editIconPickerToggle"></i>
                </div>
                <div class="icon-picker-content" id="editIconPickerContent">
                    <div class="icon-options-container" id="editIconOptions"></div>
                </div>
            </div>
            <input type="hidden" id="editSelectedIcon" value="fas fa-tag">
            <div class="color-picker-section">
                <div class="color-picker-label" id="editColorPickerLabel">
                    <div class="color-picker-text">
                        <i class="fas fa-palette"></i>
                        <span id="editColorLabel">Color</span>
                    </div>
                    <i class="fas fa-chevron-down color-picker-toggle" id="editColorPickerToggle"></i>
                </div>
                <div class="color-picker-content" id="editColorPickerContent">
                    <div class="color-options-container" id="editColorOptions"></div>
                </div>
            </div>
            <input type="hidden" id="editSelectedColor" value="#4CAF50">
            <button class="btn btn-success" id="saveEditBtn">
                <i class="fas fa-save"></i> <span id="saveEditText">Save</span>
            </button>
        </div>
    </div>
    
    <script>
        // ==================== GLOBAL VARIABLES ====================
        let categories = [];
        let editingIndex = -1;
        let totalIncome = 0;
        let currentLanguage = 'en';
        let currentTheme = 'blue';
        let isDarkMode = false;
        let sidebarSelectedColor = '#4CAF50';
        let editSelectedColor = '#4CAF50';
        let sidebarSelectedIcon = 'fas fa-tag';
        let editSelectedIcon = 'fas fa-tag';
        let archive = [];
        let expandedSections = { categories: true, language: false, theme: false, archive: false, restart: false };
        let categoriesListExpanded = true;
        let restartType = '';
        
        const defaultColors = [
            '#FF5252', '#FF4081', '#E040FB', '#7C4DFF', '#536DFE', '#448AFF', '#40C4FF', '#18FFFF', 
            '#64FFDA', '#69F0AE', '#B2FF59', '#EEFF41', '#FFFF00', '#FFD740', '#FFAB40', '#FF6E40', 
            '#FF3D00', '#795548', '#9E9E9E', '#607D8B', '#4CAF50', '#FF9800', '#2196F3', '#F44336', 
            '#9C27B0', '#00BCD4', '#8BC34A', '#FFC107', '#673AB7', '#009688', '#E91E63', '#3F51B5', 
            '#03A9F4', '#00E676', '#CDDC39', '#FFEB3B', '#FF5722', '#8D6E63', '#BDBDBD', '#90A4AE'
        ];
        
        const iconList = [
            'fas fa-home', 'fas fa-shopping-cart', 'fas fa-car', 'fas fa-utensils', 'fas fa-heartbeat', 
            'fas fa-piggy-bank', 'fas fa-graduation-cap', 'fas fa-plane', 'fas fa-music', 'fas fa-film', 
            'fas fa-book', 'fas fa-dumbbell', 'fas fa-gamepad', 'fas fa-laptop', 'fas fa-mobile-alt', 
            'fas fa-wifi', 'fas fa-bolt', 'fas fa-water', 'fas fa-gas-pump', 'fas fa-shield-alt', 
            'fas fa-user-md', 'fas fa-prescription-bottle', 'fas fa-ambulance', 'fas fa-heart', 
            'fas fa-tooth', 'fas fa-stethoscope', 'fas fa-bed', 'fas fa-pills', 'fas fa-users', 
            'fas fa-hand-holding-heart', 'fas fa-star', 'fas fa-umbrella-beach', 'fas fa-tag', 
            'fas fa-gift', 'fas fa-coffee', 'fas fa-pizza-slice', 'fas fa-tshirt', 'fas fa-bicycle', 
            'fas fa-bus', 'fas fa-train', 'fas fa-building', 'fas fa-briefcase', 'fas fa-wallet', 
            'fas fa-credit-card', 'fas fa-calculator', 'fas fa-chart-line', 'fas fa-lightbulb', 
            'fas fa-tv', 'fas fa-phone', 'fas fa-camera', 'fas fa-palette'
        ];
        
        const themes = {
            blue: { 
                name: { en: "Blue", ru: "Ð¡Ð¸Ð½Ð¸Ð¹", uz: "Ko'k" }, 
                gradient: 'linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%)', 
                primary: '#2563eb', 
                primaryDark: '#1e40af', 
                header: '#1e40af', 
                bubbleColors: ['#3b82f6', '#60a5fa', '#93c5fd', '#2563eb'] 
            },
            purple: { 
                name: { en: "Purple", ru: "Ð¤Ð¸Ð¾Ð»ÐµÑ‚Ð¾Ð²Ñ‹Ð¹", uz: "Binafsha" }, 
                gradient: 'linear-gradient(135deg, #5b21b6 0%, #7c3aed 50%, #a855f7 100%)', 
                primary: '#8b5cf6', 
                primaryDark: '#7c3aed', 
                header: '#7c3aed', 
                bubbleColors: ['#8b5cf6', '#a78bfa', '#c4b5fd', '#7c3aed'] 
            },
            green: { 
                name: { en: "Green", ru: "Ð—ÐµÐ»ÐµÐ½Ñ‹Ð¹", uz: "Yashil" }, 
                gradient: 'linear-gradient(135deg, #065f46 0%, #059669 50%, #10b981 100%)', 
                primary: '#10b981', 
                primaryDark: '#059669', 
                header: '#059669', 
                bubbleColors: ['#10b981', '#34d399', '#6ee7b7', '#059669'] 
            },
            teal: { 
                name: { en: "Teal", ru: "Ð‘Ð¸Ñ€ÑŽÐ·Ð¾Ð²Ñ‹Ð¹", uz: "Moviy-yashil" }, 
                gradient: 'linear-gradient(135deg, #0f766e 0%, #14b8a6 50%, #2dd4bf 100%)', 
                primary: '#14b8a6', 
                primaryDark: '#0d9488', 
                header: '#0d9488', 
                bubbleColors: ['#14b8a6', '#2dd4bf', '#5eead4', '#0d9488'] 
            },
            indigo: { 
                name: { en: "Indigo", ru: "Ð˜Ð½Ð´Ð¸Ð³Ð¾", uz: "Indigo" }, 
                gradient: 'linear-gradient(135deg, #3730a3 0%, #4f46e5 50%, #6366f1 100%)', 
                primary: '#6366f1', 
                primaryDark: '#4f46e5', 
                header: '#4f46e5', 
                bubbleColors: ['#6366f1', '#818cf8', '#a5b4fc', '#4f46e5'] 
            },
            cyan: { 
                name: { en: "Cyan", ru: "Ð“Ð¾Ð»ÑƒÐ±Ð¾Ð¹", uz: "Osmon rangi" }, 
                gradient: 'linear-gradient(135deg, #0e7490 0%, #06b6d4 50%, #22d3ee 100%)', 
                primary: '#06b6d4', 
                primaryDark: '#0891b2', 
                header: '#0891b2', 
                bubbleColors: ['#06b6d4', '#22d3ee', '#67e8f9', '#0891b2'] 
            },
            lime: { 
                name: { en: "Lime", ru: "Ð›Ð°Ð¹Ð¼Ð¾Ð²Ñ‹Ð¹", uz: "Yashil-sariq" }, 
                gradient: 'linear-gradient(135deg, #4d7c0f 0%, #65a30d 50%, #84cc16 100%)', 
                primary: '#84cc16', 
                primaryDark: '#65a30d', 
                header: '#65a30d', 
                bubbleColors: ['#84cc16', '#a3e635', '#bef264', '#65a30d'] 
            },
            orange: { 
                name: { en: "Orange", ru: "ÐžÑ€Ð°Ð½Ð¶ÐµÐ²Ñ‹Ð¹", uz: "To'q sariq" }, 
                gradient: 'linear-gradient(135deg, #c2410c 0%, #ea580c 50%, #f97316 100%)', 
                primary: '#f97316', 
                primaryDark: '#ea580c', 
                header: '#ea580c', 
                bubbleColors: ['#f97316', '#fb923c', '#fdba74', '#ea580c'] 
            },
            skyblue: { 
                name: { en: "Sky Blue", ru: "ÐÐµÐ±ÐµÑÐ½Ð¾-Ð³Ð¾Ð»ÑƒÐ±Ð¾Ð¹", uz: "Oq-zangori" }, 
                gradient: 'linear-gradient(135deg, #0c4a6e 0%, #0369a1 50%, #0284c7 100%)', 
                primary: '#0ea5e9', 
                primaryDark: '#0284c7', 
                header: '#0369a1', 
                bubbleColors: ['#7dd3fc', '#38bdf8', '#0ea5e9', '#0284c7'] 
            }
        };
        
        const defaultCategories = {
            en: [
                { name: "Parents", percentage: 10, color: '#4CAF50', icon: 'fas fa-users' },
                { name: "Charity", percentage: 2.5, color: '#FF9800', icon: 'fas fa-hand-holding-heart' },
                { name: "Future", percentage: 6, color: '#2196F3', icon: 'fas fa-graduation-cap' },
                { name: "Rest", percentage: 7, color: '#F44336', icon: 'fas fa-umbrella-beach' },
                { name: "Savings", percentage: 20, color: '#9C27B0', icon: 'fas fa-piggy-bank' },
                { name: "Dreams", percentage: 5, color: '#00BCD4', icon: 'fas fa-star' },
                { name: "Health", percentage: 7, color: '#8BC34A', icon: 'fas fa-heartbeat' },
                { name: "Family expenses", percentage: 42.5, color: '#795548', icon: 'fas fa-home' }
            ],
            ru: [
                { name: "Ð Ð¾Ð´Ð¸Ñ‚ÐµÐ»Ð¸", percentage: 10, color: '#4CAF50', icon: 'fas fa-users' },
                { name: "ÐœÐ¸Ð»Ð¾ÑÑ‚Ñ‹Ð½Ñ", percentage: 2.5, color: '#FF9800', icon: 'fas fa-hand-holding-heart' },
                { name: "Ð‘ÑƒÐ´ÑƒÑ‰ÐµÐµ", percentage: 6, color: '#2196F3', icon: 'fas fa-graduation-cap' },
                { name: "ÐžÑ‚Ð´Ñ‹Ñ…", percentage: 7, color: '#F44336', icon: 'fas fa-umbrella-beach' },
                { name: "ÐÐ°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð¸Ñ", percentage: 20, color: '#9C27B0', icon: 'fas fa-piggy-bank' },
                { name: "ÐœÐµÑ‡Ñ‚Ñ‹", percentage: 5, color: '#00BCD4', icon: 'fas fa-star' },
                { name: "Ð—Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ", percentage: 7, color: '#8BC34A', icon: 'fas fa-heartbeat' },
                { name: "Ð¡ÐµÐ¼ÐµÐ¹Ð½Ñ‹Ðµ Ñ€Ð°ÑÑ…Ð¾Ð´Ñ‹", percentage: 42.5, color: '#795548', icon: 'fas fa-home' }
            ],
            uz: [
                { name: "Ota-ona", percentage: 10, color: '#4CAF50', icon: 'fas fa-users' },
                { name: "Ehson", percentage: 2.5, color: '#FF9800', icon: 'fas fa-hand-holding-heart' },
                { name: "Kelajak", percentage: 6, color: '#2196F3', icon: 'fas fa-graduation-cap' },
                { name: "Dam olish", percentage: 7, color: '#F44336', icon: 'fas fa-umbrella-beach' },
                { name: "Jamg'arma", percentage: 20, color: '#9C27B0', icon: 'fas fa-piggy-bank' },
                { name: "Orzular", percentage: 5, color: '#00BCD4', icon: 'fas fa-star' },
                { name: "Salomatlik", percentage: 7, color: '#8BC34A', icon: 'fas fa-heartbeat' },
                { name: "Oilaviy xarajatlar", percentage: 42.5, color: '#795548', icon: 'fas fa-home' }
            ]
        };
        
        const translations = {
            en: { 
                appTitle: "ðŸ’° Budget Calculator", 
                sidebarTitleText: "Settings", 
                categoriesMenuTitle: "Categories", 
                languageMenuTitle: "Language", 
                themeMenuTitle: "Theme", 
                archiveMenuTitle: "Archive", 
                restartMenuTitle: "Restart Application",
                addCategoryTitle: "Add Category", 
                categoriesListTitle: "Categories List", 
                categoryNameLabel: "Category Name", 
                categoryPercentLabel: "Category Percentage (%)", 
                iconLabel: "Icon", 
                colorLabel: "Color", 
                addCategoryBtn: "Add Category", 
                alertTitle: "Attention!", 
                alertMessage: "Total percentage must equal 100%. Current:", 
                editModalTitle: "Edit Category", 
                editNameLabel: "Category Name", 
                editPercentLabel: "Category Percentage (%)", 
                editIconLabel: "Icon", 
                editColorLabel: "Color", 
                saveEditText: "Save", 
                confirmDelete: "Delete?", 
                confirmRestartAll: "Restart the application? All data will be lost!",
                confirmRestartCategories: "Reset all categories to default settings?",
                confirmRestartArchive: "Clear all archive items?",
                noArchiveTitle: "Archive is empty", 
                noArchiveText: "Calculated incomes will be saved here",
                deleteBtn: "Delete",
                copyBtn: "Copy",
                darkModeLight: "Light Mode",
                darkModeDark: "Dark Mode",
                incomePlaceholder: "Income",
                percentageExceedError: "Adding this category will exceed 100%!",
                percentageLimitError: "Total percentage cannot exceed 100%",
                calculateBtn: "Calculate",
                categoryNamePlaceholder: "Category name",
                percentagePlaceholder: "Percentage",
                restartAllTitle: "Full Restart",
                restartAllDesc: "Reset everything to default",
                restartCategoriesTitle: "Reset Categories Only",
                restartCategoriesDesc: "Keep archive and settings",
                restartArchiveTitle: "Clear Archive Only",
                restartArchiveDesc: "Keep categories and settings",
                yes: "Yes",
                no: "No",
                correct: "correct",
                correctTotal: "Total",
                copied: "Copied!",
                restartSuccess: "Application restarted successfully!",
                categoriesReset: "Categories reset to default!",
                archiveCleared: "Archive cleared!",
                copyFailed: "Copy failed. Please try again.",
                noCategoriesText: "No categories"
            },
            ru: { 
                appTitle: "ðŸ’° ÐšÐ°Ð»ÑŒÐºÑƒÐ»ÑÑ‚Ð¾Ñ€ Ð‘ÑŽÐ´Ð¶ÐµÑ‚Ð°", 
                sidebarTitleText: "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸", 
                categoriesMenuTitle: "ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸", 
                languageMenuTitle: "Ð¯Ð·Ñ‹Ðº", 
                themeMenuTitle: "Ð¢ÐµÐ¼Ð°", 
                archiveMenuTitle: "ÐÑ€Ñ…Ð¸Ð²", 
                restartMenuTitle: "ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ",
                addCategoryTitle: "Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ", 
                categoriesListTitle: "Ð¡Ð¿Ð¸ÑÐ¾Ðº ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹", 
                categoryNameLabel: "ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸", 
                categoryPercentLabel: "ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ (%)", 
                iconLabel: "Ð˜ÐºÐ¾Ð½ÐºÐ°", 
                colorLabel: "Ð¦Ð²ÐµÑ‚", 
                addCategoryBtn: "Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ", 
                alertTitle: "Ð’Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ!", 
                alertMessage: "ÐžÐ±Ñ‰Ð¸Ð¹ Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ñ€Ð°Ð²Ð½ÑÑ‚ÑŒÑÑ 100%. Ð¡ÐµÐ¹Ñ‡Ð°Ñ:", 
                editModalTitle: "Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ", 
                editNameLabel: "ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸", 
                editPercentLabel: "ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ (%)", 
                editIconLabel: "Ð˜ÐºÐ¾Ð½ÐºÐ°", 
                editColorLabel: "Ð¦Ð²ÐµÑ‚", 
                saveEditText: "Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ", 
                confirmDelete: "Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ?", 
                confirmRestartAll: "ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ? Ð’ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð±ÑƒÐ´ÑƒÑ‚ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½Ñ‹!",
                confirmRestartCategories: "Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð²ÑÐµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ðº Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ?",
                confirmRestartArchive: "Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð°Ñ€Ñ…Ð¸Ð²Ð°?",
                noArchiveTitle: "ÐÑ€Ñ…Ð¸Ð² Ð¿ÑƒÑÑ‚", 
                noArchiveText: "Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð¾Ñ…Ð¾Ð´Ñ‹ Ð±ÑƒÐ´ÑƒÑ‚ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹ Ð·Ð´ÐµÑÑŒ",
                deleteBtn: "Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ",
                copyBtn: "ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ",
                darkModeLight: "Ð¡Ð²ÐµÑ‚Ð»Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼",
                darkModeDark: "Ð¢ÐµÐ¼Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼",
                incomePlaceholder: "Ð”Ð¾Ñ…Ð¾Ð´",
                percentageExceedError: "Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚Ð¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð¿Ñ€ÐµÐ²Ñ‹ÑÐ¸Ñ‚ 100%!",
                percentageLimitError: "ÐžÐ±Ñ‰Ð¸Ð¹ Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐ°Ñ‚ÑŒ 100%",
                calculateBtn: "Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ",
                categoryNamePlaceholder: "ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸",
                percentagePlaceholder: "ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚",
                restartAllTitle: "ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ ÑÐ±Ñ€Ð¾Ñ",
                restartAllDesc: "Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð²ÑÑ‘ Ðº Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ",
                restartCategoriesTitle: "Ð¡Ð±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸",
                restartCategoriesDesc: "Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð°Ñ€Ñ…Ð¸Ð² Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸",
                restartArchiveTitle: "ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð°Ñ€Ñ…Ð¸Ð²",
                restartArchiveDesc: "Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸",
                yes: "Ð”Ð°",
                no: "ÐÐµÑ‚",
                correct: "Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾",
                correctTotal: "Ð˜Ñ‚Ð¾Ð³Ð¾",
                copied: "Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾!",
                restartSuccess: "ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾!",
                categoriesReset: "ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ ÑÐ±Ñ€Ð¾ÑˆÐµÐ½Ñ‹ Ðº Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ!",
                archiveCleared: "ÐÑ€Ñ…Ð¸Ð² Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½!",
                copyFailed: "ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.",
                noCategoriesText: "ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ Ð½ÐµÑ‚"
            },
            uz: { 
                appTitle: "ðŸ’° Byudjet Kalkulyatori", 
                sidebarTitleText: "Sozlamalar", 
                categoriesMenuTitle: "Kategoriyalar", 
                languageMenuTitle: "Til", 
                themeMenuTitle: "Mavzu", 
                archiveMenuTitle: "Arxiv", 
                restartMenuTitle: "Ilovani qayta ishga tushirish",
                addCategoryTitle: "Kategoriya qo'shish", 
                categoriesListTitle: "Kategoriyalar ro'yxati",
                categoryNameLabel: "Kategoriya nomi",
                categoryPercentLabel: "Kategoriya foizi (%)",
                iconLabel: "Belgi",
                colorLabel: "Rang", 
                addCategoryBtn: "Kategoriya qo'shish", 
                alertTitle: "Diqqat!", 
                alertMessage: "Jami foiz 100% bo'lishi kerak. Hozir:",
                editModalTitle: "Kategoriyani tahrirlash",
                editNameLabel: "Kategoriya nomi",
                editPercentLabel: "Kategoriya foizi (%)",
                editIconLabel: "Belgi",
                editColorLabel: "Rang", 
                saveEditText: "Saqlash", 
                confirmDelete: "O'chirilsinmi?", 
                confirmRestartAll: "Ilovani qayta ishga tushirishni istaysizmi? Barcha ma'lumotlar yo'qoladi!",
                confirmRestartCategories: "Barcha kategoriyalarni standart sozlamalarga qaytarishni istaysizmi?",
                confirmRestartArchive: "Barcha arxiv yozuvlarini o'chirishni istaysizmi?",
                noArchiveTitle: "Arxiv bo'sh", 
                noArchiveText: "Hisoblangan daromadlar shu yerda saqlanadi",
                deleteBtn: "O'chirish",
                copyBtn: "Nusxa olish",
                darkModeLight: "Kunduzgi rejim",
                darkModeDark: "Tungi rejim",
                incomePlaceholder: "Daromad",
                percentageExceedError: "Bu kategoriya qo'shilganda 100% dan oshib ketadi!",
                percentageLimitError: "Umumiy foiz 100% dan oshmasligi kerak",
                calculateBtn: "Hisoblash",
                categoryNamePlaceholder: "Kategoriya nomi",
                percentagePlaceholder: "Foiz",
                restartAllTitle: "To'liq qayta boshlash",
                restartAllDesc: "Hamma narsani standart holatga qaytarish",
                restartCategoriesTitle: "Faqat kategoriyalarni qaytarish",
                restartCategoriesDesc: "Arxiv va sozlamalarni saqlash",
                restartArchiveTitle: "Faqat arxivni tozalash",
                restartArchiveDesc: "Kategoriya va sozlamalarni saqlash",
                yes: "Ha",
                no: "Yo'q",
                correct: "to'g'ri",
                correctTotal: "Jami",
                copied: "Nusxalandi!",
                restartSuccess: "Ilova muvaffaqiyatli qayta ishga tushirildi!",
                categoriesReset: "Kategoriyalar standart sozlamalarga qaytarildi!",
                archiveCleared: "Arxiv tozalandi!",
                copyFailed: "Nusxa olish muvaffaqiyatsiz tugadi. Iltimos, qayta urinib ko'ring.",
                noCategoriesText: "Kategoriyalar yo'q"
            }
        };
        
        // ==================== CORE FUNCTIONS ====================
        
        function updatePlaceholders() {
            const t = translations[currentLanguage];
            
            const incomeInput = document.getElementById('incomeAmount');
            const sidebarNameInput = document.getElementById('sidebarCategoryName');
            const sidebarPercentInput = document.getElementById('sidebarCategoryPercentage');
            const editNameInput = document.getElementById('editCategoryName');
            const editPercentInput = document.getElementById('editCategoryPercentage');
            
            if (incomeInput) incomeInput.placeholder = t.incomePlaceholder;
            if (sidebarNameInput) sidebarNameInput.placeholder = t.categoryNamePlaceholder;
            if (sidebarPercentInput) sidebarPercentInput.placeholder = t.percentagePlaceholder;
            if (editNameInput) editNameInput.placeholder = t.categoryNamePlaceholder;
            if (editPercentInput) editPercentInput.placeholder = t.percentagePlaceholder;
        }
        
        function translateCategoryName(categoryName) {
            const categoryTranslations = {
                "Parents": { ru: "Ð Ð¾Ð´Ð¸Ñ‚ÐµÐ»Ð¸", uz: "Ota-ona" },
                "Charity": { ru: "ÐœÐ¸Ð»Ð¾ÑÑ‚Ñ‹Ð½Ñ", uz: "Ehson" },
                "Future": { ru: "Ð‘ÑƒÐ´ÑƒÑ‰ÐµÐµ", uz: "Kelajak" },
                "Rest": { ru: "ÐžÑ‚Ð´Ñ‹Ñ…", uz: "Dam olish" },
                "Savings": { ru: "ÐÐ°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð¸Ñ", uz: "Jamg'arma" },
                "Dreams": { ru: "ÐœÐµÑ‡Ñ‚Ñ‹", uz: "Orzular" },
                "Health": { ru: "Ð—Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ", uz: "Salomatlik" },
                "Family expenses": { ru: "Ð¡ÐµÐ¼ÐµÐ¹Ð½Ñ‹Ðµ Ñ€Ð°ÑÑ…Ð¾Ð´Ñ‹", uz: "Oilaviy xarajatlar" },
                
                "Ð Ð¾Ð´Ð¸Ñ‚ÐµÐ»Ð¸": { en: "Parents", uz: "Ota-ona" },
                "ÐœÐ¸Ð»Ð¾ÑÑ‚Ñ‹Ð½Ñ": { en: "Charity", uz: "Ehson" },
                "Ð‘ÑƒÐ´ÑƒÑ‰ÐµÐµ": { en: "Future", uz: "Kelajak" },
                "ÐžÑ‚Ð´Ñ‹Ñ…": { en: "Rest", uz: "Dam olish" },
                "ÐÐ°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð¸Ñ": { en: "Savings", uz: "Jamg'arma" },
                "ÐœÐµÑ‡Ñ‚Ñ‹": { en: "Dreams", uz: "Orzular" },
                "Ð—Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ": { en: "Health", uz: "Salomatlik" },
                "Ð¡ÐµÐ¼ÐµÐ¹Ð½Ñ‹Ðµ Ñ€Ð°ÑÑ…Ð¾Ð´Ñ‹": { en: "Family expenses", uz: "Oilaviy xarajatlar" },
                
                "Ota-ona": { en: "Parents", ru: "Ð Ð¾Ð´Ð¸Ñ‚ÐµÐ»Ð¸" },
                "Ehson": { en: "Charity", ru: "ÐœÐ¸Ð»Ð¾ÑÑ‚Ñ‹Ð½Ñ" },
                "Kelajak": { en: "Future", ru: "Ð‘ÑƒÐ´ÑƒÑ‰ÐµÐµ" },
                "Dam olish": { en: "Rest", ru: "ÐžÑ‚Ð´Ñ‹Ñ…" },
                "Jamg'arma": { en: "Savings", ru: "ÐÐ°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð¸Ñ" },
                "Orzular": { en: "Dreams", ru: "ÐœÐµÑ‡Ñ‚Ñ‹" },
                "Salomatlik": { en: "Health", ru: "Ð—Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ" },
                "Oilaviy xarajatlar": { en: "Family expenses", ru: "Ð¡ÐµÐ¼ÐµÐ¹Ð½Ñ‹Ðµ Ñ€Ð°ÑÑ…Ð¾Ð´Ñ‹" }
            };
            
            if (categoryTranslations[categoryName] && categoryTranslations[categoryName][currentLanguage]) {
                return categoryTranslations[categoryName][currentLanguage];
            }
            
            return categoryName;
        }
        
        function formatNumber(num) {
            if (isNaN(num) || !isFinite(num)) return "0";
            
            if (num > 999999999999) {
                num = 999999999999;
            }
            
            const rounded = Math.round(num * 100) / 100;
            
            if (rounded % 1 === 0) {
                return Math.round(rounded).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
            }
            
            let str = rounded.toFixed(2);
            str = str.replace(/\.?0+$/, '');
            
            return str.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }
        
        function formatNumberForArchive(num) {
            if (isNaN(num) || !isFinite(num)) return "0";
            
            if (num > 999999999999) {
                num = 999999999999;
            }
            
            const rounded = Math.round(num * 1000) / 1000;
            
            if (rounded % 1 === 0) {
                return Math.round(rounded).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
            }
            
            let str = rounded.toFixed(3);
            str = str.replace(/\.?0+$/, '');
            
            return str.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }
        
        function generateArchiveText(item) {
            const t = translations[currentLanguage];
            const dateStr = item.date + " " + item.time;
            const incomeStr = formatNumber(item.income);
            let text = "ðŸ“… " + dateStr + "\n";
            text += "ðŸ’° " + t.incomePlaceholder + ": " + incomeStr + "\n\n";
            
            let totalCheck = 0;
            
            item.categories.forEach((category) => {
                const amount = (item.income * category.percentage) / 100;
                const amountStr = formatNumberForArchive(amount);
                const translatedName = translateCategoryName(category.name);
                text += "â€¢ " + translatedName + ": " + amountStr + " (" + category.percentage.toFixed(1) + "%)\n";
                
                totalCheck += amount;
            });
            
            const exactTotal = totalCheck.toFixed(3);
            const roundedTotal = Math.round(totalCheck * 100) / 100;
            const incomeRounded = Math.round(item.income * 100) / 100;
            
            if (Math.abs(roundedTotal - incomeRounded) > 0.01) {
                text += "\nâœ… " + t.correctTotal + ": " + formatNumberForArchive(totalCheck) + " (" + t.correct + ")";
            }
            
            return text;
        }
        
        function toggleCategoriesListSection() {
            categoriesListExpanded = !categoriesListExpanded;
            const list = document.getElementById('categoriesList');
            const toggle = document.getElementById('categoriesListToggle');
            const alert = document.getElementById('percentageAlert');
            
            if (categoriesListExpanded) {
                list.classList.remove('collapsed');
                toggle.style.transform = 'rotate(0deg)';
                if (alert.style.display !== 'none') {
                    alert.style.display = 'block';
                }
            } else {
                list.classList.add('collapsed');
                toggle.style.transform = 'rotate(-90deg)';
                alert.style.display = 'none';
            }
            
            saveData();
        }
        
        function loadCategoriesListState() {
            if (!categoriesListExpanded) {
                const list = document.getElementById('categoriesList');
                const toggle = document.getElementById('categoriesListToggle');
                const alert = document.getElementById('percentageAlert');
                list.classList.add('collapsed');
                toggle.style.transform = 'rotate(-90deg)';
                alert.style.display = 'none';
            }
        }
        
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            const body = document.body;
            const icon = document.getElementById('darkModeToggle');
            const t = translations[currentLanguage];
            
            if (isDarkMode) {
                body.classList.add('dark-mode');
                body.classList.remove('light-mode');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                icon.title = t.darkModeLight;
            } else {
                body.classList.add('light-mode');
                body.classList.remove('dark-mode');
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                icon.title = t.darkModeDark;
            }
            
            applyTheme(currentTheme);
            saveData();
        }
        
        function applyTheme(themeName) {
            const theme = themes[themeName];
            if (!theme) return;
            
            Object.keys(themes).forEach(key => {
                document.body.classList.remove('theme-' + key);
            });
            
            document.body.classList.add('theme-' + themeName);
            
            document.documentElement.style.setProperty('--bg-gradient', theme.gradient);
            document.documentElement.style.setProperty('--primary-color', theme.primary);
            document.documentElement.style.setProperty('--primary-dark', theme.primaryDark);
            document.documentElement.style.setProperty('--header-bg', theme.header);
            
            if (isDarkMode) {
                if (themeName === 'skyblue') {
                    document.documentElement.style.setProperty('--sidebar-bg', 'linear-gradient(135deg, #0c4a6e 0%, #0369a1 100%)');
                    document.documentElement.style.setProperty('--modal-bg', 'linear-gradient(135deg, #0284c7 0%, #0ea5e9 100%)');
                }
            } else {
                if (themeName === 'skyblue') {
                    document.documentElement.style.setProperty('--sidebar-bg', 'linear-gradient(135deg, #7dd3fc 0%, #38bdf8 100%)');
                    document.documentElement.style.setProperty('--modal-bg', 'linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)');
                }
            }
            
            const bubbles = document.querySelectorAll('.bubble');
            bubbles.forEach((bubble, index) => {
                const color = theme.bubbleColors[index % theme.bubbleColors.length];
                bubble.style.background = `linear-gradient(135deg, ${color} 0%, ${theme.primaryDark} 100%)`;
            });
            
            currentTheme = themeName;
            saveData();
            
            expandedSections.theme = false;
            const themeContent = document.getElementById('themeContent');
            const themeToggle = document.getElementById('themeToggle2');
            const themeHeader = themeToggle ? themeToggle.closest('.menu-section-header') : null;
            if (themeContent && themeToggle && themeHeader) {
                themeContent.classList.remove('expanded');
                themeToggle.classList.remove('rotated');
                themeHeader.classList.remove('active');
            }
            
            createThemeOptions();
        }
        
        function toggleMenuSection(section) {
            if (expandedSections[section]) {
                expandedSections[section] = false;
                const content = document.getElementById(section + 'Content');
                const toggle = document.getElementById(section + 'Toggle' + (section === 'theme' ? '2' : ''));
                const header = toggle.closest('.menu-section-header');
                content.classList.remove('expanded');
                toggle.classList.remove('rotated');
                header.classList.remove('active');
            } else {
                Object.keys(expandedSections).forEach(key => {
                    expandedSections[key] = false;
                    const content = document.getElementById(key + 'Content');
                    const toggle = document.getElementById(key + 'Toggle' + (key === 'theme' ? '2' : ''));
                    const header = toggle ? toggle.closest('.menu-section-header') : null;
                    if (content && toggle && header) {
                        content.classList.remove('expanded');
                        toggle.classList.remove('rotated');
                        header.classList.remove('active');
                    }
                });
                expandedSections[section] = true;
                const content = document.getElementById(section + 'Content');
                const toggle = document.getElementById(section + 'Toggle' + (section === 'theme' ? '2' : ''));
                const header = toggle.closest('.menu-section-header');
                content.classList.add('expanded');
                toggle.classList.add('rotated');
                header.classList.add('active');
            }
            saveData();
        }
        
        function loadExpandedSections() {
            Object.keys(expandedSections).forEach(section => {
                const content = document.getElementById(section + 'Content');
                const toggle = document.getElementById(section + 'Toggle' + (section === 'theme' ? '2' : ''));
                const header = toggle ? toggle.closest('.menu-section-header') : null;
                if (content && toggle && header && expandedSections[section]) {
                    content.classList.add('expanded');
                    toggle.classList.add('rotated');
                    header.classList.add('active');
                }
            });
        }
        
        function createColorOptions(containerId, selectedColor) {
            const container = document.getElementById(containerId);
            if (!container) return;
            let html = '';
            defaultColors.forEach((color) => {
                const isSelected = color === selectedColor;
                html += `<div class="color-option ${isSelected ? 'selected' : ''}" style="background-color: ${color}" data-color="${color}" onclick="selectSidebarColor('${containerId}', '${color}')"></div>`;
            });
            container.innerHTML = html;
        }
        
        function createIconOptions(containerId, selectedIcon) {
            const container = document.getElementById(containerId);
            if (!container) return;
            let html = '';
            iconList.forEach((icon) => {
                const isSelected = icon === selectedIcon;
                html += `<div class="icon-option ${isSelected ? 'selected' : ''}" data-icon="${icon}" onclick="selectSidebarIcon('${containerId}', '${icon}')"><i class="${icon}"></i></div>`;
            });
            container.innerHTML = html;
        }
        
        function selectSidebarColor(containerId, color) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
            const selected = container.querySelector(`[data-color="${color}"]`);
            if (selected) selected.classList.add('selected');
            if (containerId === 'sidebarColorOptions') {
                sidebarSelectedColor = color;
                document.getElementById('sidebarSelectedColor').value = color;
            } else {
                editSelectedColor = color;
                document.getElementById('editSelectedColor').value = color;
            }
            
            if (containerId === 'sidebarColorOptions') {
                document.getElementById('sidebarColorPickerContent').classList.remove('show');
                document.getElementById('sidebarColorPickerToggle').classList.remove('rotated');
            } else if (containerId === 'editColorOptions') {
                document.getElementById('editColorPickerContent').classList.remove('show');
                document.getElementById('editColorPickerToggle').classList.remove('rotated');
            }
        }
        
        function selectSidebarIcon(containerId, icon) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.querySelectorAll('.icon-option').forEach(opt => opt.classList.remove('selected'));
            const selected = container.querySelector(`[data-icon="${icon}"]`);
            if (selected) selected.classList.add('selected');
            if (containerId === 'sidebarIconOptions') {
                sidebarSelectedIcon = icon;
                document.getElementById('sidebarSelectedIcon').value = icon;
            } else {
                editSelectedIcon = icon;
                document.getElementById('editSelectedIcon').value = icon;
            }
            
            if (containerId === 'sidebarIconOptions') {
                document.getElementById('sidebarIconPickerContent').classList.remove('show');
                document.getElementById('sidebarIconPickerToggle').classList.remove('rotated');
            } else if (containerId === 'editIconOptions') {
                document.getElementById('editIconPickerContent').classList.remove('show');
                document.getElementById('editIconPickerToggle').classList.remove('rotated');
            }
        }
        
        function toggleSidebarColorPicker(type) {
            const contentId = type === 'sidebar' ? 'sidebarColorPickerContent' : 'editColorPickerContent';
            const toggleId = type === 'sidebar' ? 'sidebarColorPickerToggle' : 'editColorPickerToggle';
            const content = document.getElementById(contentId);
            const toggle = document.getElementById(toggleId);
            if (content && toggle) {
                content.classList.toggle('show');
                toggle.classList.toggle('rotated');
            }
        }
        
        function toggleSidebarIconPicker(type) {
            const contentId = type === 'sidebar' ? 'sidebarIconPickerContent' : 'editIconPickerContent';
            const toggleId = type === 'sidebar' ? 'sidebarIconPickerToggle' : 'editIconPickerToggle';
            const content = document.getElementById(contentId);
            const toggle = document.getElementById(toggleId);
            if (content && toggle) {
                content.classList.toggle('show');
                toggle.classList.toggle('rotated');
            }
        }
        
        function closeConfirm() {
            document.getElementById('confirmOverlay').style.display = 'none';
            document.getElementById('confirmBox').style.display = 'none';
        }
        
        function renderCategories() {
            const container = document.getElementById('categoriesList');
            if (!container) return;
            
            const t = translations[currentLanguage];
            
            if (categories.length === 0) {
                container.innerHTML = `<div class="empty-state" style="padding: 20px;"><i class="fas fa-folder-open"></i><h3 style="font-size: 14px;">${t.noCategoriesText}</h3></div>`;
                return;
            }
            let html = '';
            categories.forEach((category, index) => {
                const translatedName = translateCategoryName(category.name);
                html += `<div class="category-item-edit" onclick="editCategory(${index})">
                    <div class="cat-info">
                        <div class="cat-icon" style="background:${category.color}">
                            <i class="${category.icon || 'fas fa-tag'}"></i>
                        </div>
                        <div class="cat-details">
                            <h3>${translatedName}</h3>
                            <span style="font-size: 11px; opacity: 0.8;">${category.percentage}%</span>
                        </div>
                    </div>
                    <div class="cat-actions">
                        <button class="action-btn delete" onclick="event.stopPropagation(); showDeleteConfirm(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
            updateStats();
        }
        
        function showDeleteConfirm(index) {
            const overlay = document.getElementById('confirmOverlay');
            const box = document.getElementById('confirmBox');
            const text = document.getElementById('confirmText');
            const t = translations[currentLanguage];
            
            if (!overlay || !box || !text) return;
            
            overlay.style.display = 'block';
            box.style.display = 'block';
            text.textContent = t.confirmDelete;
            
            const confirmYesBtn = document.getElementById('confirmYesBtn');
            if (confirmYesBtn) {
                const newBtn = confirmYesBtn.cloneNode(true);
                confirmYesBtn.parentNode.replaceChild(newBtn, confirmYesBtn);
                
                document.getElementById('confirmYesBtn').onclick = function() {
                    categories.splice(index, 1);
                    saveData();
                    if (totalIncome > 0) calculateDistribution();
                    closeConfirm();
                    renderCategories();
                };
            }
        }
        
        function updateStats() {
            const totalPercentage = categories.reduce((sum, cat) => sum + cat.percentage, 0);
            const alertElement = document.getElementById('percentageAlert');
            const alertMessageEl = document.getElementById('alertMessage');
            const currentPercentageEl = document.getElementById('currentPercentage');
            const t = translations[currentLanguage];
            
            if (alertElement && alertMessageEl && currentPercentageEl) {
                if (Math.abs(totalPercentage - 100) > 0.1) {
                    const currentPercent = totalPercentage.toFixed(1);
                    currentPercentageEl.textContent = currentPercent;
                    alertMessageEl.innerHTML = t.alertMessage + ' <span id="currentPercentage">' + currentPercent + '</span>%';
                    alertElement.style.display = 'block';
                } else {
                    alertElement.style.display = 'none';
                }
            }
        }
        
        function checkPercentageLimit(newPercentage) {
            const currentTotal = categories.reduce((sum, cat) => sum + cat.percentage, 0);
            return currentTotal + newPercentage <= 100;
        }
        
        function checkEditPercentageLimit(currentIndex, newPercentage) {
            const currentTotal = categories.reduce((sum, cat, idx) => {
                if (idx === currentIndex) return sum;
                return sum + cat.percentage;
            }, 0);
            return currentTotal + newPercentage <= 100;
        }
        
        function editCategory(index) {
            editingIndex = index;
            const category = categories[index];
            
            const nameInput = document.getElementById('editCategoryName');
            const percentInput = document.getElementById('editCategoryPercentage');
            if (!nameInput || !percentInput) return;
            
            nameInput.value = category.name;
            percentInput.value = category.percentage;
            const color = category.color || '#4CAF50';
            const icon = category.icon || 'fas fa-tag';
            editSelectedColor = color;
            editSelectedIcon = icon;
            document.getElementById('editSelectedColor').value = color;
            document.getElementById('editSelectedIcon').value = icon;
            createColorOptions('editColorOptions', color);
            createIconOptions('editIconOptions', icon);
            
            const colorContent = document.getElementById('editColorPickerContent');
            const colorToggle = document.getElementById('editColorPickerToggle');
            const iconContent = document.getElementById('editIconPickerContent');
            const iconToggle = document.getElementById('editIconPickerToggle');
            
            if (colorContent && colorToggle) {
                colorContent.classList.remove('show');
                colorToggle.classList.remove('rotated');
            }
            if (iconContent && iconToggle) {
                iconContent.classList.remove('show');
                iconToggle.classList.remove('rotated');
            }
            
            const editModal = document.getElementById('editModal');
            if (editModal) {
                editModal.style.display = 'flex';
            }
        }
        
        function calculateDistribution() {
            const container = document.getElementById('categoryResults');
            if (!container) return;
            
            let incomeNum = totalIncome;
            if (incomeNum > 999999999999) {
                incomeNum = 999999999999;
            }
            
            let resultsHtml = '';
            let totalCalculated = 0;
            const exactAmounts = [];
            
            categories.forEach((category, index) => {
                const exactAmount = (incomeNum * category.percentage) / 100;
                const roundedAmount = Math.round(exactAmount * 100) / 100;
                exactAmounts.push({
                    exact: exactAmount,
                    rounded: roundedAmount,
                    index: index
                });
                totalCalculated += roundedAmount;
            });
            
            const remainder = Math.round((incomeNum - totalCalculated) * 100) / 100;
            
            if (Math.abs(remainder) > 0.001) {
                let maxIndex = 0;
                let maxAmount = 0;
                exactAmounts.forEach(item => {
                    if (item.exact > maxAmount) {
                        maxAmount = item.exact;
                        maxIndex = item.index;
                    }
                });
                
                exactAmounts[maxIndex].rounded += remainder;
                exactAmounts[maxIndex].rounded = Math.round(exactAmounts[maxIndex].rounded * 100) / 100;
            }
            
            categories.forEach((category, index) => {
                const amount = exactAmounts.find(item => item.index === index)?.rounded || 0;
                const color = category.color || defaultColors[index % defaultColors.length];
                const icon = category.icon || 'fas fa-tag';
                const translatedName = translateCategoryName(category.name);
                resultsHtml += `
                    <div class="category-item">
                        <div class="cat-info">
                            <div class="cat-icon" style="background:${color}">
                                <i class="${icon}"></i>
                            </div>
                            <div class="cat-details">
                                <h3>${translatedName}</h3>
                            </div>
                        </div>
                        <div class="cat-amount">
                            <span class="amount-val">${formatNumber(amount)}</span>
                            <span class="percent-tag">${category.percentage.toFixed(1)}%</span>
                        </div>
                    </div>`;
            });
            container.innerHTML = resultsHtml;
        }
        
        function saveToArchive() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' });
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            
            const archiveItem = { 
                date: dateStr, 
                time: timeStr, 
                income: totalIncome, 
                categories: JSON.parse(JSON.stringify(categories)),
                text: generateArchiveText({
                    date: dateStr,
                    time: timeStr,
                    income: totalIncome,
                    categories: JSON.parse(JSON.stringify(categories))
                })
            };
            
            archive.unshift(archiveItem);
            if (archive.length > 15) archive = archive.slice(0, 15);
            saveData();
            renderArchive();
        }
        
        function renderArchive() {
            const container = document.getElementById('archiveList');
            if (!container) return;
            
            const t = translations[currentLanguage];
            
            if (archive.length === 0) {
                container.innerHTML = `<div class="empty-state"><i class="fas fa-folder-open"></i><h3 id="noArchiveTitle">${t.noArchiveTitle}</h3><p id="noArchiveText">${t.noArchiveText}</p></div>`;
                return;
            }
            let html = '';
            archive.forEach((item, index) => {
                const updatedText = generateArchiveText(item);
                html += `<div class="archive-item">
                    <div class="archive-item-header">
                        <div class="archive-date">${item.date} ${item.time}</div>
                        <div class="archive-income">${formatNumber(item.income)}</div>
                    </div>
                    <div class="archive-text">${updatedText}</div>
                    <div class="archive-actions">
                        <button class="archive-btn copy" onclick="copyArchiveItem(${index})">
                            <i class="fas fa-copy"></i> ${t.copyBtn}
                        </button>
                        <button class="archive-btn delete" onclick="deleteArchiveItem(${index})">
                            <i class="fas fa-trash"></i> ${t.deleteBtn}
                        </button>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }
        
        function copyArchiveItem(index) {
            const item = archive[index];
            const text = generateArchiveText(item);
            const t = translations[currentLanguage];
            
            navigator.clipboard.writeText(text)
                .then(() => {
                    const copyBtns = document.querySelectorAll('.archive-btn.copy');
                    if (copyBtns[index]) {
                        const copyBtn = copyBtns[index];
                        const originalHTML = '<i class="fas fa-copy"></i> ' + t.copyBtn;
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> ' + t.copied;
                        copyBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                        
                        setTimeout(() => {
                            copyBtn.innerHTML = originalHTML;
                            copyBtn.style.background = 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)';
                        }, 2000);
                    }
                })
                .catch(err => {
                    showNotification(t.copyFailed, 'error');
                });
        }
        
        function deleteArchiveItem(index) {
            const overlay = document.getElementById('confirmOverlay');
            const box = document.getElementById('confirmBox');
            const text = document.getElementById('confirmText');
            const t = translations[currentLanguage];
            
            if (!overlay || !box || !text) return;
            
            overlay.style.display = 'block';
            box.style.display = 'block';
            text.textContent = t.confirmDelete;
            
            const confirmYesBtn = document.getElementById('confirmYesBtn');
            if (confirmYesBtn) {
                const newBtn = confirmYesBtn.cloneNode(true);
                confirmYesBtn.parentNode.replaceChild(newBtn, confirmYesBtn);
                
                document.getElementById('confirmYesBtn').onclick = function() {
                    archive.splice(index, 1);
                    saveData();
                    renderArchive();
                    closeConfirm();
                };
            }
        }
        
        // ==================== RESTART FUNCTIONS ====================
        
        function showRestartConfirm(type) {
            restartType = type;
            
            const overlay = document.getElementById('confirmOverlay');
            const box = document.getElementById('confirmBox');
            const text = document.getElementById('confirmText');
            
            if (!overlay || !box || !text) return;
            
            overlay.style.display = 'block';
            box.style.display = 'block';
            
            const t = translations[currentLanguage];
            let confirmText = '';
            
            switch(type) {
                case 'all':
                    confirmText = t.confirmRestartAll;
                    break;
                case 'categories':
                    confirmText = t.confirmRestartCategories;
                    break;
                case 'archive':
                    confirmText = t.confirmRestartArchive;
                    break;
            }
            
            text.textContent = confirmText;
            
            const confirmYesBtn = document.getElementById('confirmYesBtn');
            if (confirmYesBtn) {
                const newBtn = confirmYesBtn.cloneNode(true);
                confirmYesBtn.parentNode.replaceChild(newBtn, confirmYesBtn);
                
                document.getElementById('confirmYesBtn').onclick = function() {
                    performRestart(restartType);
                    closeConfirm();
                };
            }
        }
        
        function performRestart(type) {
            const t = translations[currentLanguage];
            
            switch(type) {
                case 'all':
                    localStorage.removeItem('budget_data');
                    
                    categories = JSON.parse(JSON.stringify(defaultCategories[currentLanguage]));
                    archive = [];
                    currentLanguage = 'en';
                    currentTheme = 'blue';
                    isDarkMode = false;
                    expandedSections = { categories: true, language: false, theme: false, archive: false, restart: false };
                    categoriesListExpanded = true;
                    
                    applyLoadedData();
                    
                    const incomeInput = document.getElementById('incomeAmount');
                    const resultsContainer = document.getElementById('categoryResults');
                    if (incomeInput) incomeInput.value = '';
                    if (resultsContainer) resultsContainer.innerHTML = '';
                    totalIncome = 0;
                    
                    const sidebar = document.getElementById('sidebar');
                    const overlay = document.getElementById('sidebarOverlay');
                    if (sidebar) sidebar.classList.remove('show');
                    if (overlay) overlay.classList.remove('show');
                    
                    showNotification(translations['en'].restartSuccess, 'success');
                    break;
                    
                case 'categories':
                    categories = JSON.parse(JSON.stringify(defaultCategories[currentLanguage]));
                    saveData();
                    renderCategories();
                    
                    if (totalIncome > 0) {
                        calculateDistribution();
                    }
                    
                    showNotification(t.categoriesReset, 'success');
                    break;
                    
                case 'archive':
                    archive = [];
                    saveData();
                    renderArchive();
                    
                    showNotification(t.archiveCleared, 'success');
                    break;
            }
        }
        
        // ==================== NOTIFICATION FUNCTION ====================
        
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        function getErrorMessage(errorType) {
            const t = translations[currentLanguage];
            const errorMessages = {
                'percentageExceed': t.percentageExceedError,
                'percentageLimit': t.percentageLimitError,
                'emptyField': '',
                'invalidNumber': ''
            };
            return errorMessages[errorType] || '';
        }
        
        function showInputError(inputElement, errorType = 'emptyField') {
            if (!inputElement) return;
            
            inputElement.classList.add('input-error');
            setTimeout(() => inputElement.classList.remove('input-error'), 2000);
            
            const message = getErrorMessage(errorType);
            if (message) {
                const errorElement = inputElement.closest('.form-group')?.querySelector('.error-message');
                if (errorElement) {
                    errorElement.style.display = 'flex';
                    const errorText = errorElement.querySelector('span');
                    if (errorText) errorText.textContent = message;
                    
                    setTimeout(() => {
                        errorElement.style.display = 'none';
                    }, 3000);
                }
            }
        }
        
        // ==================== LANGUAGE FUNCTIONS ====================
        
        function createLanguageOptionsSidebar() {
            const container = document.getElementById('languageOptionsSidebar');
            if (!container) return;
            
            const languages = [ 
                { code: 'en', name: 'English', flag: 'ðŸ‡ºðŸ‡¸' }, 
                { code: 'ru', name: 'Ð ÑƒÑÑÐºÐ¸Ð¹', flag: 'ðŸ‡·ðŸ‡º' }, 
                { code: 'uz', name: "O'zbek", flag: 'ðŸ‡ºðŸ‡¿' } 
            ];
            let html = '';
            languages.forEach(lang => {
                const isActive = currentLanguage === lang.code;
                html += `<div class="language-option-sidebar ${isActive ? 'active' : ''}" onclick="changeLanguage('${lang.code}')" style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 18px;">${lang.flag}</span>
                        <span>${lang.name}</span>
                    </div>
                    ${isActive ? '<i class="fas fa-check"></i>' : ''}
                </div>`;
            });
            container.innerHTML = html;
        }
        
        function changeLanguage(lang) {
            document.querySelectorAll('.language-option-sidebar').forEach(option => {
                option.classList.remove('active');
                const checkIcon = option.querySelector('i.fa-check');
                if (checkIcon) {
                    checkIcon.remove();
                }
            });
            
            currentLanguage = lang;
            
            const activeOption = document.querySelector(`.language-option-sidebar[onclick*="changeLanguage('${lang}')"]`);
            if (activeOption) {
                activeOption.classList.add('active');
                const checkIcon = document.createElement('i');
                checkIcon.className = 'fas fa-check';
                activeOption.appendChild(checkIcon);
            }
            
            expandedSections.language = false;
            const languageContent = document.getElementById('languageContent');
            const languageToggle = document.getElementById('languageToggle');
            const languageHeader = languageToggle ? languageToggle.closest('.menu-section-header') : null;
            
            if (languageContent && languageToggle && languageHeader) {
                languageContent.classList.remove('expanded');
                languageToggle.classList.remove('rotated');
                languageHeader.classList.remove('active');
            }
            
            categories = categories.map(cat => {
                const isDefault = 
                    defaultCategories['en'].some(defaultCat => defaultCat.name === cat.name) ||
                    defaultCategories['ru'].some(defaultCat => defaultCat.name === cat.name) ||
                    defaultCategories['uz'].some(defaultCat => defaultCat.name === cat.name);
                
                if (isDefault) {
                    const translatedName = translateCategoryName(cat.name);
                    return { ...cat, name: translatedName };
                } else {
                    return cat;
                }
            });
            
            archive = archive.map(item => {
                return {
                    ...item,
                    text: generateArchiveText(item)
                };
            });
            
            if (totalIncome > 0) {
                calculateDistribution();
            }
            
            updateTexts();
            updatePlaceholders();
            createThemeOptions();
            renderArchive();
            renderCategories();
            saveData();
        }
        
        function updateTexts() {
            const t = translations[currentLanguage];
            
            const elements = [
                { id: 'appTitle', text: t.appTitle },
                { id: 'sidebarTitleText', text: t.sidebarTitleText },
                { id: 'categoriesMenuTitle', text: t.categoriesMenuTitle },
                { id: 'languageMenuTitle', text: t.languageMenuTitle },
                { id: 'themeMenuTitle', text: t.themeMenuTitle },
                { id: 'archiveMenuTitle', text: t.archiveMenuTitle },
                { id: 'restartMenuTitle', text: t.restartMenuTitle },
                { id: 'addCategoryTitle', text: t.addCategoryTitle },
                { id: 'categoriesListTitle', text: t.categoriesListTitle },
                { id: 'addCategoryBtn', text: t.addCategoryBtn },
                { id: 'alertTitle', text: t.alertTitle },
                { id: 'editModalTitle', text: t.editModalTitle },
                { id: 'saveEditText', text: t.saveEditText },
                { id: 'iconLabel', text: t.iconLabel },
                { id: 'colorLabel', text: t.colorLabel },
                { id: 'editIconLabel', text: t.iconLabel },
                { id: 'editColorLabel', text: t.colorLabel },
                { id: 'restartAllTitle', text: t.restartAllTitle },
                { id: 'restartAllDesc', text: t.restartAllDesc },
                { id: 'restartCategoriesTitle', text: t.restartCategoriesTitle },
                { id: 'restartCategoriesDesc', text: t.restartCategoriesDesc },
                { id: 'restartArchiveTitle', text: t.restartArchiveTitle },
                { id: 'restartArchiveDesc', text: t.restartArchiveDesc },
                { id: 'confirmYesBtn', text: t.yes },
                { id: 'confirmNoBtn', text: t.no }
            ];
            
            elements.forEach(element => {
                const el = document.getElementById(element.id);
                if (el) {
                    el.textContent = element.text;
                }
            });
            
            const alertMessageEl = document.getElementById('alertMessage');
            if (alertMessageEl) {
                const currentPercentSpan = alertMessageEl.querySelector('#currentPercentage');
                const currentPercent = currentPercentSpan ? currentPercentSpan.textContent : '0';
                alertMessageEl.innerHTML = t.alertMessage + ' <span id="currentPercentage">' + currentPercent + '</span>%';
            }
            
            const icon = document.getElementById('darkModeToggle');
            if (icon) {
                icon.title = isDarkMode ? t.darkModeLight : t.darkModeDark;
            }
            
            updateStats();
        }
        
        function createThemeOptions() {
            const container = document.getElementById('themeOptionsSidebar');
            if (!container) return;
            
            let html = '';
            Object.keys(themes).forEach(themeKey => {
                const theme = themes[themeKey];
                const isActive = currentTheme === themeKey;
                const themeName = theme.name[currentLanguage] || theme.name.en;
                html += `<div class="theme-option-sidebar ${isActive ? 'active' : ''}" onclick="applyTheme('${themeKey}')">
                    <div><span>${themeName}</span></div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="theme-option-preview">
                            <div class="theme-preview-circle" style="background: ${theme.primary};"></div>
                            <div class="theme-preview-circle" style="background: ${theme.primaryDark};"></div>
                        </div>
                        ${isActive ? '<i class="fas fa-check"></i>' : ''}
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }
        
        function saveData() {
            try {
                const data = {
                    categories: categories,
                    language: currentLanguage,
                    theme: currentTheme,
                    darkMode: isDarkMode,
                    archive: archive,
                    expandedSections: expandedSections,
                    categoriesListExpanded: categoriesListExpanded
                };
                
                localStorage.setItem('budget_data', JSON.stringify(data));
            } catch (error) {
                console.error("Error saving data:", error);
            }
        }
        
        function loadData() {
            try {
                const saved = localStorage.getItem('budget_data');
                if (saved) {
                    const data = JSON.parse(saved);
                    
                    categories = data.categories || JSON.parse(JSON.stringify(defaultCategories[currentLanguage]));
                    currentLanguage = data.language || 'en';
                    currentTheme = data.theme || 'blue';
                    isDarkMode = data.darkMode || false;
                    archive = data.archive || [];
                    expandedSections = data.expandedSections || { 
                        categories: true, 
                        language: false, 
                        theme: false, 
                        archive: false, 
                        restart: false
                    };
                    categoriesListExpanded = data.categoriesListExpanded !== undefined ? data.categoriesListExpanded : true;
                    
                    applyLoadedData();
                } else {
                    categories = JSON.parse(JSON.stringify(defaultCategories[currentLanguage]));
                    applyLoadedData();
                }
            } catch (error) {
                console.error("Error loading data:", error);
                categories = JSON.parse(JSON.stringify(defaultCategories[currentLanguage]));
                applyLoadedData();
            }
        }
        
        function applyLoadedData() {
            updateTexts();
            updatePlaceholders();
            createLanguageOptionsSidebar();
            createThemeOptions();
            applyTheme(currentTheme);
            
            const body = document.body;
            const icon = document.getElementById('darkModeToggle');
            const t = translations[currentLanguage];
            if (isDarkMode) {
                body.classList.add('dark-mode');
                body.classList.remove('light-mode');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                icon.title = t.darkModeLight;
            } else {
                body.classList.add('light-mode');
                body.classList.remove('dark-mode');
                icon.classList.add('fa-moon');
                icon.classList.remove('fa-sun');
                icon.title = t.darkModeDark;
            }
            
            renderCategories();
            renderArchive();
            loadExpandedSections();
            loadCategoriesListState();
        }
        
        // ==================== EVENT HANDLER FUNCTIONS ====================
        
        function addCategoryHandler() {
            const nameInput = document.getElementById('sidebarCategoryName');
            const percentInput = document.getElementById('sidebarCategoryPercentage');
            const name = nameInput.value.trim();
            const percentage = parseFloat(percentInput.value);
            const color = sidebarSelectedColor;
            const icon = sidebarSelectedIcon;
            
            if (!name) {
                showInputError(nameInput, 'emptyField');
                return;
            }
            
            if (isNaN(percentage) || percentage <= 0) {
                showInputError(percentInput, 'invalidNumber');
                return;
            }
            
            if (!checkPercentageLimit(percentage)) {
                showInputError(percentInput, 'percentageExceed');
                return;
            }
            
            if (percentage > 100) {
                showInputError(percentInput, 'percentageLimit');
                return;
            }
            
            if (categories.some(cat => cat.name.toLowerCase() === name.toLowerCase())) {
                showInputError(nameInput, 'emptyField');
                return;
            }
            
            categories.push({ name, percentage, color, icon });
            nameInput.value = '';
            percentInput.value = '';
            sidebarSelectedColor = '#4CAF50';
            sidebarSelectedIcon = 'fas fa-tag';
            document.getElementById('sidebarSelectedColor').value = '#4CAF50';
            document.getElementById('sidebarSelectedIcon').value = 'fas fa-tag';
            createColorOptions('sidebarColorOptions', '#4CAF50');
            createIconOptions('sidebarIconOptions', 'fas fa-tag');
            
            saveData();
            renderCategories();
            if (nameInput) nameInput.focus();
        }
        
        function closeEditModal() {
            const editModal = document.getElementById('editModal');
            if (editModal) {
                editModal.style.display = 'none';
            }
            editingIndex = -1;
        }
        
        function saveEditHandler() {
            if (editingIndex === -1) return;
            
            const newName = document.getElementById('editCategoryName').value.trim();
            const newPercentage = parseFloat(document.getElementById('editCategoryPercentage').value);
            const newColor = editSelectedColor;
            const newIcon = editSelectedIcon;
            
            if (!newName) {
                const nameInput = document.getElementById('editCategoryName');
                showInputError(nameInput, 'emptyField');
                return;
            }
            
            if (isNaN(newPercentage) || newPercentage <= 0) {
                const percentInput = document.getElementById('editCategoryPercentage');
                showInputError(percentInput, 'invalidNumber');
                return;
            }
            
            if (!checkEditPercentageLimit(editingIndex, newPercentage)) {
                const percentInput = document.getElementById('editCategoryPercentage');
                showInputError(percentInput, 'percentageExceed');
                return;
            }
            
            if (newPercentage > 100) {
                const percentInput = document.getElementById('editCategoryPercentage');
                showInputError(percentInput, 'percentageLimit');
                return;
            }
            
            const duplicate = categories.some((cat, idx) => idx !== editingIndex && cat.name.toLowerCase() === newName.toLowerCase());
            if (duplicate) {
                const nameInput = document.getElementById('editCategoryName');
                showInputError(nameInput, 'emptyField');
                return;
            }
            
            categories[editingIndex] = { ...categories[editingIndex], name: newName, percentage: newPercentage, color: newColor, icon: newIcon };
            closeEditModal();
            saveData();
            renderCategories();
            if (totalIncome > 0) calculateDistribution();
        }
        
        function calculateDistributionHandler() {
            const incomeInput = document.getElementById('incomeAmount');
            if (!incomeInput) return;
            
            let incomeValue = incomeInput.value.replace(/\s/g, '').replace(/\D/g, '');
            
            if (!incomeValue || incomeValue.trim() === '' || incomeValue === '0') { 
                showInputError(incomeInput, 'emptyField');
                return; 
            }
            
            if (incomeValue.length > 12) {
                incomeValue = incomeValue.slice(0, 12);
            }
            
            totalIncome = parseFloat(incomeValue);
            
            if (isNaN(totalIncome) || totalIncome <= 0) { 
                showInputError(incomeInput, 'invalidNumber');
                return; 
            }
            
            if (categories.length === 0) { 
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebarOverlay');
                if (sidebar && overlay) {
                    sidebar.classList.add('show');
                    overlay.classList.add('show');
                }
                return; 
            }
            
            const totalPercentage = categories.reduce((sum, cat) => sum + cat.percentage, 0);
            if (Math.abs(totalPercentage - 100) > 0.1) { 
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebarOverlay');
                if (sidebar && overlay) {
                    sidebar.classList.add('show');
                    overlay.classList.add('show');
                }
                
                if (!expandedSections.categories) {
                    toggleMenuSection('categories');
                }
                
                if (!categoriesListExpanded) {
                    toggleCategoriesListSection();
                }
                
                return; 
            }
            
            calculateDistribution();
            saveToArchive();
        }
        
        function handleIncomeInput(e) {
            let value = e.target.value.replace(/\D/g, '');
            
            if (value.length > 12) {
                value = value.slice(0, 12);
                e.target.classList.add('input-error');
                setTimeout(() => e.target.classList.remove('input-error'), 1000);
            }
            
            if (value.length > 0) {
                value = value.replace(/^0+/, '') || '0';
                
                const numValue = parseInt(value);
                if (numValue >= 0) {
                    e.target.value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
                } else {
                    e.target.value = '';
                }
            } else {
                e.target.value = '';
            }
        }
        
        function handleIncomeKeypress(e) {
            if (!/\d/.test(e.key) && e.key !== 'Backspace' && e.key !== 'Delete' && e.key !== 'Tab' && e.key !== 'Enter') {
                e.preventDefault();
                return;
            }
            
            const currentValue = e.target.value.replace(/\D/g, '');
            
            if (currentValue.length >= 12 && /\d/.test(e.key)) {
                e.preventDefault();
                e.target.classList.add('input-error');
                setTimeout(() => e.target.classList.remove('input-error'), 1000);
                return;
            }
            
            if (e.key === 'Enter') {
                const calculateBtn = document.getElementById('calculateBtn');
                if (calculateBtn) calculateBtn.click();
            }
        }
        
        function handleIncomePaste(e) {
            e.preventDefault();
            
            const pastedText = (e.clipboardData || window.clipboardData).getData('text');
            const numbersOnly = pastedText.replace(/\D/g, '');
            const limitedNumbers = numbersOnly.slice(0, 12);
            
            const currentValue = e.target.value.replace(/\D/g, '');
            const combinedValue = (currentValue + limitedNumbers).slice(0, 12);
            
            if (combinedValue.length > 0) {
                const formattedValue = combinedValue.replace(/^0+/, '') || '0';
                e.target.value = formattedValue.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
            } else {
                e.target.value = '';
            }
            
            if (combinedValue.length > 12) {
                e.target.classList.add('input-error');
                setTimeout(() => e.target.classList.remove('input-error'), 1000);
            }
        }
        
        function handleIncomeFocus(e) {
            const value = e.target.value.replace(/\s/g, '');
            if (value && value !== '0') {
                e.target.value = value;
            }
        }
        
        function handleIncomeBlur(e) {
            const value = e.target.value.replace(/\s/g, '').replace(/\D/g, '');
            if (value && value !== '0') {
                e.target.value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
            }
        }
        
        function openSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (sidebar && overlay) {
                sidebar.classList.add('show');
                overlay.classList.add('show');
            }
        }
        
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (sidebar && overlay) {
                sidebar.classList.remove('show');
                overlay.classList.remove('show');
            }
        }
        
        function handleEscapeKey(e) {
            if (e.key === 'Escape') {
                if (editingIndex !== -1) {
                    closeEditModal();
                }
                closeSidebar();
                
                const pickers = [
                    'sidebarColorPickerContent', 'editColorPickerContent',
                    'sidebarIconPickerContent', 'editIconPickerContent'
                ];
                
                pickers.forEach(id => {
                    const element = document.getElementById(id);
                    const toggle = document.getElementById(id.replace('Content', 'Toggle'));
                    if (element && toggle) {
                        element.classList.remove('show');
                        toggle.classList.remove('rotated');
                    }
                });
                
                closeConfirm();
            }
        }
        
        // ==================== INITIALIZATION ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            try {
                createColorOptions('sidebarColorOptions', '#4CAF50');
                createColorOptions('editColorOptions', '#4CAF50');
                createIconOptions('sidebarIconOptions', 'fas fa-tag');
                createIconOptions('editIconOptions', 'fas fa-tag');
            } catch (error) {
                console.error("UI elementlarini yaratishda xato:", error);
            }
            
            loadData();
            setupEventListeners();
            
            setInterval(() => {
                saveData();
            }, 30000);
            
            window.addEventListener('beforeunload', () => {
                saveData();
            });
        });
        
        function setupEventListeners() {
            try {
                const sidebarAddBtn = document.getElementById('sidebarAddCategoryBtn');
                const closeModalBtn = document.getElementById('closeModal');
                const saveEditBtn = document.getElementById('saveEditBtn');
                const calculateBtn = document.getElementById('calculateBtn');
                
                if (sidebarAddBtn) sidebarAddBtn.addEventListener('click', addCategoryHandler);
                if (closeModalBtn) closeModalBtn.addEventListener('click', closeEditModal);
                if (saveEditBtn) saveEditBtn.addEventListener('click', saveEditHandler);
                if (calculateBtn) calculateBtn.addEventListener('click', calculateDistributionHandler);
                
                const incomeInput = document.getElementById('incomeAmount');
                if (incomeInput) {
                    incomeInput.addEventListener('input', handleIncomeInput);
                    incomeInput.addEventListener('keypress', handleIncomeKeypress);
                    incomeInput.addEventListener('paste', handleIncomePaste);
                    incomeInput.addEventListener('focus', handleIncomeFocus);
                    incomeInput.addEventListener('blur', handleIncomeBlur);
                }
                
                const sidebarColorLabel = document.getElementById('sidebarColorPickerLabel');
                const editColorLabel = document.getElementById('editColorPickerLabel');
                const sidebarIconLabel = document.getElementById('sidebarIconPickerLabel');
                const editIconLabel = document.getElementById('editIconPickerLabel');
                
                if (sidebarColorLabel) sidebarColorLabel.addEventListener('click', () => toggleSidebarColorPicker('sidebar'));
                if (editColorLabel) editColorLabel.addEventListener('click', () => toggleSidebarColorPicker('edit'));
                if (sidebarIconLabel) sidebarIconLabel.addEventListener('click', () => toggleSidebarIconPicker('sidebar'));
                if (editIconLabel) editIconLabel.addEventListener('click', () => toggleSidebarIconPicker('edit'));
                
                const darkModeToggle = document.getElementById('darkModeToggle');
                const menuBtn = document.getElementById('menuBtn');
                const sidebarOverlay = document.getElementById('sidebarOverlay');
                
                if (darkModeToggle) darkModeToggle.addEventListener('click', toggleDarkMode);
                if (menuBtn) menuBtn.addEventListener('click', openSidebar);
                if (sidebarOverlay) sidebarOverlay.addEventListener('click', closeSidebar);
                
                document.addEventListener('keydown', handleEscapeKey);
                
                const editModal = document.getElementById('editModal');
                if (editModal) {
                    editModal.addEventListener('click', function(e) {
                        if (e.target === editModal) {
                            closeEditModal();
                        }
                    });
                }
                
            } catch (error) {
                console.error("Event listener'larni sozlashda xato:", error);
            }
        }
        
        window.toggleMenuSection = toggleMenuSection;
        window.toggleCategoriesListSection = toggleCategoriesListSection;
        window.editCategory = editCategory;
        window.showDeleteConfirm = showDeleteConfirm;
        window.closeConfirm = closeConfirm;
        window.copyArchiveItem = copyArchiveItem;
        window.deleteArchiveItem = deleteArchiveItem;
        window.changeLanguage = changeLanguage;
        window.applyTheme = applyTheme;
        window.selectSidebarColor = selectSidebarColor;
        window.selectSidebarIcon = selectSidebarIcon;
        window.showRestartConfirm = showRestartConfirm;
        window.performRestart = performRestart;
        
    </script>
</body>
</html>